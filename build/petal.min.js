(function(){var d={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:j,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:j,lheading:/^([^\n]+)\n *(=|-){3,} *\n*/,blockquote:/^( *>[^\n]+(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:j,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};d.bullet=/(?:[*+-]|\d+\.)/;d.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/;d.item=c(d.item,"gm")(/bull/g,d.bullet)();d.list=c(d.list)(/bull/g,d.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)();d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b";d.html=c(d.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,d._tag)();d.paragraph=c(d.paragraph)("hr",d.hr)("heading",d.heading)("lheading",d.lheading)("blockquote",d.blockquote)("tag","<"+d._tag)("def",d.def)();d.normal=g({},d);d.gfm=g({},d.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/});d.gfm.paragraph=c(d.paragraph)("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|")();d.tables=g({},d.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/});function b(k){this.tokens=[];this.tokens.links={};this.options=k||a.defaults;this.rules=d.normal;if(this.options.gfm){if(this.options.tables){this.rules=d.tables}else{this.rules=d.gfm}}}b.rules=d;b.lex=function(m,k){var l=new b(k);return l.lex(m)};b.prototype.lex=function(k){k=k.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n");return this.token(k,true)};b.prototype.token=function(m,s){var m=m.replace(/^ +$/gm,""),q,o,u,r,t,v,k,p,n;while(m){if(u=this.rules.newline.exec(m)){m=m.substring(u[0].length);if(u[0].length>1){this.tokens.push({type:"space"})}}if(u=this.rules.code.exec(m)){m=m.substring(u[0].length);u=u[0].replace(/^ {4}/gm,"");this.tokens.push({type:"code",text:!this.options.pedantic?u.replace(/\n+$/,""):u});continue}if(u=this.rules.fences.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:"code",lang:u[2],text:u[3]});continue}if(u=this.rules.heading.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:"heading",depth:u[1].length,text:u[2]});continue}if(s&&(u=this.rules.nptable.exec(m))){m=m.substring(u[0].length);v={type:"table",header:u[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:u[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:u[3].replace(/\n$/,"").split("\n")};for(p=0;p<v.align.length;p++){if(/^ *-+: *$/.test(v.align[p])){v.align[p]="right"}else{if(/^ *:-+: *$/.test(v.align[p])){v.align[p]="center"}else{if(/^ *:-+ *$/.test(v.align[p])){v.align[p]="left"}else{v.align[p]=null}}}}for(p=0;p<v.cells.length;p++){v.cells[p]=v.cells[p].split(/ *\| */)}this.tokens.push(v);continue}if(u=this.rules.lheading.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:"heading",depth:u[2]==="="?1:2,text:u[1]});continue}if(u=this.rules.hr.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:"hr"});continue}if(u=this.rules.blockquote.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:"blockquote_start"});u=u[0].replace(/^ *> ?/gm,"");this.token(u,s);this.tokens.push({type:"blockquote_end"});continue}if(u=this.rules.list.exec(m)){m=m.substring(u[0].length);r=u[2];this.tokens.push({type:"list_start",ordered:r.length>1});u=u[0].match(this.rules.item);q=false;n=u.length;p=0;for(;p<n;p++){v=u[p];k=v.length;v=v.replace(/^ *([*+-]|\d+\.) +/,"");if(~v.indexOf("\n ")){k-=v.length;v=!this.options.pedantic?v.replace(new RegExp("^ {1,"+k+"}","gm"),""):v.replace(/^ {1,4}/gm,"")}if(this.options.smartLists&&p!==n-1){t=d.bullet.exec(u[p+1])[0];if(r!==t&&!(r.length>1&&t.length>1)){m=u.slice(p+1).join("\n")+m;p=n-1}}o=q||/\n\n(?!\s*$)/.test(v);if(p!==n-1){q=v[v.length-1]==="\n";if(!o){o=q}}this.tokens.push({type:o?"loose_item_start":"list_item_start"});this.token(v,false);this.tokens.push({type:"list_item_end"})}this.tokens.push({type:"list_end"});continue}if(u=this.rules.html.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:u[1]==="pre"||u[1]==="script",text:u[0]});continue}if(s&&(u=this.rules.def.exec(m))){m=m.substring(u[0].length);this.tokens.links[u[1].toLowerCase()]={href:u[2],title:u[3]};continue}if(s&&(u=this.rules.table.exec(m))){m=m.substring(u[0].length);v={type:"table",header:u[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:u[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:u[3].replace(/(?: *\| *)?\n$/,"").split("\n")};for(p=0;p<v.align.length;p++){if(/^ *-+: *$/.test(v.align[p])){v.align[p]="right"}else{if(/^ *:-+: *$/.test(v.align[p])){v.align[p]="center"}else{if(/^ *:-+ *$/.test(v.align[p])){v.align[p]="left"}else{v.align[p]=null}}}}for(p=0;p<v.cells.length;p++){v.cells[p]=v.cells[p].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */)}this.tokens.push(v);continue}if(s&&(u=this.rules.paragraph.exec(m))){m=m.substring(u[0].length);this.tokens.push({type:"paragraph",text:u[1][u[1].length-1]==="\n"?u[1].slice(0,-1):u[1]});continue}if(u=this.rules.text.exec(m)){m=m.substring(u[0].length);this.tokens.push({type:"text",text:u[0]});continue}if(m){throw new Error("Infinite loop on byte: "+m.charCodeAt(0))}}return this.tokens};var f={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:j,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:j,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};f._inside=/(?:\[[^\]]*\]|[^\]]|\](?=[^\[]*\]))*/;f._href=/\s*<?([^\s]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/;f.link=c(f.link)("inside",f._inside)("href",f._href)();f.reflink=c(f.reflink)("inside",f._inside)();f.normal=g({},f);f.pedantic=g({},f.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/});f.gfm=g({},f.normal,{escape:c(f.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:c(f.text)("]|","~]|")("|","|https?://|")()});f.breaks=g({},f.gfm,{br:c(f.br)("{2,}","*")(),text:c(f.gfm.text)("{2,}","*")()});function h(k,l){this.options=l||a.defaults;this.links=k;this.rules=f.normal;if(!this.links){throw new Error("Tokens array requires a `links` property.")}if(this.options.gfm){if(this.options.breaks){this.rules=f.breaks}else{this.rules=f.gfm}}else{if(this.options.pedantic){this.rules=f.pedantic}}}h.rules=f;h.output=function(n,k,l){var m=new h(k,l);return m.output(n)};h.prototype.output=function(p){var l="",n,o,k,m;while(p){if(m=this.rules.escape.exec(p)){p=p.substring(m[0].length);l+=m[1];continue}if(m=this.rules.autolink.exec(p)){p=p.substring(m[0].length);if(m[2]==="@"){o=m[1][6]===":"?this.mangle(m[1].substring(7)):this.mangle(m[1]);k=this.mangle("mailto:")+o}else{o=i(m[1]);k=o}l+='<a href="'+k+'">'+o+"</a>";continue}if(m=this.rules.url.exec(p)){p=p.substring(m[0].length);o=i(m[1]);k=o;l+='<a href="'+k+'">'+o+"</a>";continue}if(m=this.rules.tag.exec(p)){p=p.substring(m[0].length);l+=this.options.sanitize?i(m[0]):m[0];continue}if(m=this.rules.link.exec(p)){p=p.substring(m[0].length);l+=this.outputLink(m,{href:m[2],title:m[3]});continue}if((m=this.rules.reflink.exec(p))||(m=this.rules.nolink.exec(p))){p=p.substring(m[0].length);n=(m[2]||m[1]).replace(/\s+/g," ");n=this.links[n.toLowerCase()];if(!n||!n.href){l+=m[0][0];p=m[0].substring(1)+p;continue}l+=this.outputLink(m,n);continue}if(m=this.rules.strong.exec(p)){p=p.substring(m[0].length);l+="<strong>"+this.output(m[2]||m[1])+"</strong>";continue}if(m=this.rules.em.exec(p)){p=p.substring(m[0].length);l+="<em>"+this.output(m[2]||m[1])+"</em>";continue}if(m=this.rules.code.exec(p)){p=p.substring(m[0].length);l+="<code>"+i(m[2],true)+"</code>";continue}if(m=this.rules.br.exec(p)){p=p.substring(m[0].length);l+="<br>";continue}if(m=this.rules.del.exec(p)){p=p.substring(m[0].length);l+="<del>"+this.output(m[1])+"</del>";continue}if(m=this.rules.text.exec(p)){p=p.substring(m[0].length);l+=i(m[0]);continue}if(p){throw new Error("Infinite loop on byte: "+p.charCodeAt(0))}}return l};h.prototype.outputLink=function(k,l){if(k[0][0]!=="!"){return'<a href="'+i(l.href)+'"'+(l.title?' title="'+i(l.title)+'"':"")+">"+this.output(k[1])+"</a>"}else{return'<img src="'+i(l.href)+'" alt="'+i(k[1])+'"'+(l.title?' title="'+i(l.title)+'"':"")+">"}};h.prototype.smartypants=function(k){if(!this.options.smartypants){return k}return k.replace(/--/g,"—").replace(/'([^']*)'/g,"‘$1’").replace(/"([^"]*)"/g,"“$1”").replace(/\.{3}/g,"…")};h.prototype.mangle=function(p){var m="",k=p.length,n=0,o;for(;n<k;n++){o=p.charCodeAt(n);if(Math.random()>0.5){o="x"+o.toString(16)}m+="&#"+o+";"}return m};function e(k){this.tokens=[];this.token=null;this.options=k||a.defaults}e.parse=function(l,k){var m=new e(k);return m.parse(l)};e.prototype.parse=function(l){this.inline=new h(l.links,this.options);this.tokens=l.reverse();var k="";while(this.next()){k+=this.tok()}return k};e.prototype.next=function(){return this.token=this.tokens.pop()};e.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0};e.prototype.parseText=function(){var k=this.token.text;while(this.peek().type==="text"){k+="\n"+this.next().text}return this.inline.output(k)};e.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return"<hr>\n";case"heading":return"<h"+this.token.depth+">"+this.inline.output(this.token.text)+"</h"+this.token.depth+">\n";case"code":if(this.options.highlight){var p=this.options.highlight(this.token.text,this.token.lang);if(p!=null&&p!==this.token.text){this.token.escaped=true;this.token.text=p}}if(!this.token.escaped){this.token.text=i(this.token.text,true)}return"<pre><code"+(this.token.lang?' class="'+this.options.langPrefix+this.token.lang+'"':"")+">"+this.token.text+"</code></pre>\n";case"table":var l="",q,n,r,k,m;l+="<thead>\n<tr>\n";for(n=0;n<this.token.header.length;n++){q=this.inline.output(this.token.header[n]);l+=this.token.align[n]?'<th align="'+this.token.align[n]+'">'+q+"</th>\n":"<th>"+q+"</th>\n"}l+="</tr>\n</thead>\n";l+="<tbody>\n";for(n=0;n<this.token.cells.length;n++){r=this.token.cells[n];l+="<tr>\n";for(m=0;m<r.length;m++){k=this.inline.output(r[m]);l+=this.token.align[m]?'<td align="'+this.token.align[m]+'">'+k+"</td>\n":"<td>"+k+"</td>\n"}l+="</tr>\n"}l+="</tbody>\n";return"<table>\n"+l+"</table>\n";case"blockquote_start":var l="";while(this.next().type!=="blockquote_end"){l+=this.tok()}return"<blockquote>\n"+l+"</blockquote>\n";case"list_start":var o=this.token.ordered?"ol":"ul",l="";while(this.next().type!=="list_end"){l+=this.tok()}return"<"+o+">\n"+l+"</"+o+">\n";case"list_item_start":var l="";while(this.next().type!=="list_item_end"){l+=this.token.type==="text"?this.parseText():this.tok()}return"<li>"+l+"</li>\n";case"loose_item_start":var l="";while(this.next().type!=="list_item_end"){l+=this.tok()}return"<li>"+l+"</li>\n";case"html":return !this.token.pre&&!this.options.pedantic?this.inline.output(this.token.text):this.token.text;case"paragraph":return"<p>"+this.inline.output(this.token.text)+"</p>\n";case"text":return"<p>"+this.parseText()+"</p>\n"}};function i(k,l){return k.replace(!l?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function c(m,l){m=m.source;l=l||"";return function k(n,o){if(!n){return new RegExp(m,l)}o=o.source||o;o=o.replace(/(^|[^\[])\^/g,"$1");m=m.replace(n,o);return k}}function j(){}j.exec=j;function g(n){var l=1,m,k;for(;l<arguments.length;l++){m=arguments[l];for(k in m){if(Object.prototype.hasOwnProperty.call(m,k)){n[k]=m[k]}}}return n}function a(k,n,u){if(u||typeof n==="function"){if(!u){u=n;n=null}if(n){n=g({},a.defaults,n)}var t=b.lex(t,n),o=n.highlight,m=0,p=t.length,r=0;if(!o||o.length<3){return u(null,e.parse(t,n))}var q=function(){delete n.highlight;var l=e.parse(t,n);n.highlight=o;return u(null,l)};for(;r<p;r++){(function(l){if(l.type!=="code"){return}m++;return o(l.text,l.lang,function(w,v){if(v==null||v===l.text){return --m||q()}l.text=v;l.escaped=true;--m||q()})})(t[r])}return}try{if(n){n=g({},a.defaults,n)}return e.parse(b.lex(k,n),n)}catch(s){s.message+="\nPlease report this to https://github.com/chjj/marked.";if((n||a.defaults).silent){return"<p>An error occured:</p><pre>"+i(s.message+"",true)+"</pre>"}throw s}}a.options=a.setOptions=function(k){g(a.defaults,k);return a};a.defaults={gfm:true,tables:true,breaks:false,pedantic:false,sanitize:false,smartLists:false,silent:false,highlight:null,langPrefix:"lang-"};a.Parser=e;a.parser=e.parse;a.Lexer=b;a.lexer=b.lex;a.InlineLexer=h;a.inlineLexer=h.output;a.parse=a;if(typeof exports==="object"){module.exports=a}else{if(typeof define==="function"&&define.amd){define(function(){return a})}else{this.marked=a}}}).call(function(){return this||(typeof window!=="undefined"?window:global)}());window.url=(function(){function b(c){return !isNaN(parseFloat(c))&&isFinite(c)}return function a(p,d){var c=d||window.location.toString();if(c.substring(0,2)==="//"){c="http:"+c}else{if(c.split("://").length===1){c="http://"+c}}d=c.split("/");var g={auth:""},o=d[2].split("@");if(o.length===1){o=o[0].split(":")}else{g.auth=o[0];o=o[1].split(":")}g.protocol=d[0],g.hostname=o[0],g.port=(o[1]||"80"),g.pathname="/"+d.slice(3,d.length).join("/").split("?")[0].split("#")[0];var e=g.pathname;if(e.split(".").length===1&&e[e.length-1]!=="/"){e+="/"}var k=g.hostname,l=k.split("."),m=e.split("/");if(!p){return c}else{if(p==="hostname"){return k}else{if(p==="domain"){return l.slice(-2).join(".")}else{if(p==="tld"){return l.slice(-1).join(".")}else{if(p==="sub"){return l.slice(0,l.length-2).join(".")}else{if(p==="port"){return g.port||"80"}else{if(p==="protocol"){return g.protocol.split(":")[0]}else{if(p==="auth"){return g.auth}else{if(p==="user"){return g.auth.split(":")[0]}else{if(p==="pass"){return g.auth.split(":")[1]||""}else{if(p==="path"){return e}else{if(p[0]==="."){p=p.substring(1);if(b(p)){p=parseInt(p);return l[p<0?l.length+p:p-1]||""}}else{if(b(p)){p=parseInt(p);return m[p<0?m.length-1+p:p]||""}else{if(p==="file"){return m.slice(-1)[0]}else{if(p==="filename"){return m.slice(-1)[0].split(".")[0]}else{if(p==="fileext"){return m.slice(-1)[0].split(".")[1]||""}else{if(p[0]==="?"||p[0]==="#"){var h=c,f=null;if(p[0]==="?"){h=(h.split("?")[1]||"").split("#")[0]}else{if(p[0]==="#"){h=(h.split("#")[1]||"")}}if(!p[1]){return h}p=p.substring(1);h=h.split("&");for(var j=0,n=h.length;j<n;j++){f=h[j].split("=");if(f[0]===p){return f[1]}}return null}}}}}}}}}}}}}}}}}return""}})();function removeParameter(b,h){var e=b.split("?");if(e.length>=2){var a=e.shift();var g=e.join("?");var f=encodeURIComponent(h)+"=";var d=g.split(/[&;]/g);for(var c=d.length;c-->0;){if(d[c].lastIndexOf(f,0)!==-1){d.splice(c,1)}}b=a+"?"+d.join("&")}return b}(function(){(function(a){if(typeof define==="function"&&define.amd){return define(["jquery"],a)}else{return a(window.jQuery)}})(function(e){var f,c,b,a,d,g;d=(function(){h.prototype.css_attr=["overflowY","height","width","paddingTop","paddingLeft","paddingRight","paddingBottom","marginTop","marginLeft","marginRight","marginBottom","fontFamily","borderStyle","borderWidth","wordWrap","fontSize","lineHeight","overflowX","text-align"];function h(i){this.$inputor=i}h.prototype.copy_inputor_css=function(){var i,j=this;i={position:"absolute",left:-9999,top:0,zIndex:-20000,"white-space":"pre-wrap"};e.each(this.css_attr,function(k,l){return i[l]=j.$inputor.css(l)});return i};h.prototype.create=function(i){this.$mirror=e("<div></div>");this.$mirror.css(this.copy_inputor_css());this.$mirror.html(i);this.$inputor.after(this.$mirror);return this};h.prototype.get_flag_rect=function(){var j,k,i;j=this.$mirror.find("span#flag");k=j.position();i={left:k.left,top:k.top,bottom:j.height()+k.top};this.$mirror.remove();return i};return h})();a={DOWN:40,UP:38,ESC:27,TAB:9,ENTER:13};c={data_refactor:function(h){if(!e.isArray(h)){return h}return e.map(h,function(j,i){if(!e.isPlainObject(j)){j={name:j}}return j})},matcher:function(i,k){var j,h,l;l=new RegExp(i+"([A-Za-z0-9_+-]*)$|"+i+"([^\\x00-\\xff]*)$","gi");j=l.exec(k);h=null;if(j){h=j[2]?j[2]:j[1]}return h},filter:function(j,i,h){var k=this;return e.map(i,function(n,m){var l;l=e.isPlainObject(n)?n[h]:n;if(l.toLowerCase().indexOf(j)>=0){return n}})},remote_filter:function(j,h,i){return e.ajax(h,{data:j,success:function(k){return i(k)}})},sorter:function(n,i,l){var k,j,o,m,h;if(!n){return i.sort(function(q,p){if(q[l].toLowerCase()>p[l].toLowerCase()){return 1}else{return -1}})}j=[];for(m=0,h=i.length;m<h;m++){k=i[m];o=k[l];k.order=o.toLowerCase().indexOf(n);j.push(k)}return j.sort(function(q,p){return q.order-p.order})},tpl_eval:function(i,k){var j;try{return j=i.replace(/\$\{([^\}]*)\}/g,function(l,m,n){return k[m]})}catch(h){return""}},highlighter:function(h,i){if(!i){return h}return h.replace(new RegExp(">\\s*(\\w*)("+i.replace("+","\\+")+")(\\w*)\\s*<","ig"),function(l,j,m,k){return"> "+j+"<strong>"+m+"</strong>"+k+" <"})},selector:function(h){if(h.length>0){return this.replace_str(h.data("value")||"")}}};f=(function(){function h(i){this.settings={};this.common_settings={};this.pos=0;this.flags=null;this.current_flag=null;this.query=null;this.$inputor=e(i);this.mirror=new d(this.$inputor);this.common_settings=e.extend({},e.fn.atwho["default"]);this.view=new g(this,this.$el);this.listen()}h.prototype.listen=function(){var i=this;return this.$inputor.on("keyup.atwho",function(j){return i.on_keyup(j)}).on("keydown.atwho",function(j){return i.on_keydown(j)}).on("scroll.atwho",function(j){return i.view.hide()}).on("blur.atwho",function(j){return i.view.hide(i.get_opt("display_timeout"))})};h.prototype.reg=function(i,j){var l,k;l={};l=e.isPlainObject(i)?this.common_settings=e.extend({},this.common_settings,i):!this.settings[i]?this.settings[i]=e.extend({},j):this.settings[i]=e.extend({},this.settings[i],j);k=l.data;l.data=this.callbacks("data_refactor").call(this,k);return this};h.prototype.trigger=function(i,j){j||(j=[]);j.push(this);return this.$inputor.trigger(""+i+".atwho",j)};h.prototype.data=function(i){if(i){return this.$inputor.data("atwho-data",i)}else{return this.$inputor.data("atwho-data")}};h.prototype.callbacks=function(i){var j;if(!(j=this.get_opt("callbacks",{})[i])){j=this.common_settings.callbacks[i]}return j};h.prototype.get_opt=function(j,i){var k;try{if(this.current_flag){k=this.settings[this.current_flag][j]}if(k===void 0){k=this.common_settings[j]}return k=k===void 0?i:k}catch(l){return k=i===void 0?null:i}};h.prototype.rect=function(){var p,j,m,i,r,l,k,n,q,o;p=this.$inputor;if(document.selection){j=document.selection.createRange();q=j.boundingLeft+p.scrollLeft();o=j.boundingTop+e(window).scrollTop()+p.scrollTop();i=o+j.boundingHeight;return{top:o-2,left:q-2,bottom:i-2}}r=function(s){return s.replace(/</g,"&lt").replace(/>/g,"&gt").replace(/`/g,"&#96").replace(/"/g,"&quot").replace(/\r\n|\r|\n/g,"<br />")};n=p.val().slice(0,this.pos-1);l="<span>"+r(n)+"</span>";l+="<span id='flag'>?</span>";k=p.offset();m=this.mirror.create(l).get_flag_rect();q=k.left+m.left-p.scrollLeft();o=k.top-p.scrollTop();i=o+m.bottom;o+=m.top;return{top:o,left:q,bottom:i+2}};h.prototype.catch_query=function(){var i,l,j,m,o,k,n=this;l=this.$inputor.val();i=this.$inputor.caretPos();k=l.slice(0,i);m=null;e.each(this.settings,function(p,q){m=n.callbacks("matcher").call(n,p,k);if(m!=null){n.current_flag=p;return false}});if(typeof m==="string"&&m.length<=20){o=i-m.length;j=o+m.length;this.pos=o;m={text:m.toLowerCase(),head_pos:o,end_pos:j};this.trigger("matched",[this.current_flag,m.text])}else{this.view.hide()}return this.query=m};h.prototype.replace_str=function(m){var j,l,i,n,k;j=this.$inputor;i=j.val();l=this.get_opt("display_flag")?0:this.current_flag.length;n=i.slice(0,(this.query.head_pos||0)-l);k=""+n+m+" "+(i.slice(this.query.end_pos||0));j.val(k);j.caretPos(n.length+m.length+1);return j.change()};h.prototype.on_keyup=function(i){switch(i.keyCode){case a.ESC:i.preventDefault();this.view.hide();break;case a.DOWN:case a.UP:e.noop();break;default:this.look_up()}return i.stopPropagation()};h.prototype.on_keydown=function(i){if(!this.view.visible()){return}switch(i.keyCode){case a.ESC:i.preventDefault();this.view.hide();break;case a.UP:i.preventDefault();this.view.prev();break;case a.DOWN:i.preventDefault();this.view.next();break;case a.TAB:case a.ENTER:if(!this.view.visible()){return}i.preventDefault();this.view.choose();break;default:e.noop()}return i.stopPropagation()};h.prototype.render_view=function(j){var i;i=this.get_opt("search_key");j=this.callbacks("sorter").call(this,this.query.text,j,i);j=j.splice(0,this.get_opt("limit"));this.data(j);return this.view.render(j)};h.prototype.remote_call=function(k,j){var l,i;l={q:j.text,limit:this.get_opt("limit")};i=function(m){return this.render_view(m)};i=e.proxy(i,this);return this.callbacks("remote_filter").call(this,l,k,i)};h.prototype.look_up=function(){var k,j,i;j=this.catch_query();if(!j){return false}k=this.get_opt("data");i=this.get_opt("search_key");if(typeof k==="string"){this.remote_call(k,j)}else{if((k=this.callbacks("filter").call(this,j.text,k,i))){this.render_view(k)}else{this.view.hide()}}return e.noop()};return h})();g=(function(){function h(i){this.controller=i;this.id=this.controller.get_opt("view_id","at-view");this.timeout_id=null;this.$el=e("#"+this.id);this.create_view()}h.prototype.create_view=function(){var j,i,k=this;if(this.exist()){return}i="<div id='"+this.id+"' class='at-view'><ul id='"+this.id+"-ul'></ul></div>";e("body").append(i);this.$el=e("#"+this.id);j=this.$el.find("ul");return j.on("mouseenter.view","li",function(l){j.find(".cur").removeClass("cur");return e(l.currentTarget).addClass("cur")}).on("click",function(l){l.stopPropagation();l.preventDefault();return k.$el.data("_view").choose()})};h.prototype.exist=function(){return e("#"+this.id).length>0};h.prototype.visible=function(){return this.$el.is(":visible")};h.prototype.choose=function(){var i;i=this.$el.find(".cur");this.controller.callbacks("selector").call(this.controller,i);this.controller.trigger("choose",[i]);return this.hide()};h.prototype.reposition=function(){var j,i;i=this.controller.rect();if(i.bottom+this.$el.height()-e(window).scrollTop()>e(window).height()){i.bottom=i.top-this.$el.height()}j={left:i.left,top:i.bottom};this.$el.offset(j);return this.controller.trigger("reposition",[j])};h.prototype.next=function(){var j,i;j=this.$el.find(".cur").removeClass("cur");i=j.next();if(!i.length){i=e(this.$el.find("li")[0])}return i.addClass("cur")};h.prototype.prev=function(){var j,i;j=this.$el.find(".cur").removeClass("cur");i=j.prev();if(!i.length){i=this.$el.find("li").last()}return i.addClass("cur")};h.prototype.show=function(){if(!this.visible()){this.$el.show()}return this.reposition()};h.prototype.hide=function(i){var k,j=this;if(isNaN(i)){if(this.visible()){return this.$el.hide()}}else{k=function(){return j.hide()};clearTimeout(this.timeout_id);return this.timeout_id=setTimeout(k,i)}};h.prototype.clear=function(){return this.$el.find("ul").empty()};h.prototype.render=function(k){var j,i,l=this;if(!e.isArray(k)){return false}if(k.length<=0){this.hide();return true}this.clear();this.$el.data("_view",this);j=this.$el.find("ul");i=this.controller.get_opt("tpl",b);e.each(k,function(n,o){var p,m;m=l.controller.callbacks("tpl_eval").call(l.controller,i,o);p=e(l.controller.callbacks("highlighter").call(l.controller,m,l.controller.query.text));p.data("info",o);return j.append(p)});this.show();return j.find("li:eq(0)").addClass("cur")};return h})();b="<li data-value='${name}'>${name}</li>";e.fn.atwho=function(h,i){return this.filter("textarea, input").each(function(){var k,j;k=e(this);j=k.data("atwho");if(!j){k.data("atwho",(j=new f(this)))}return j.reg(h,i)})};e.fn.atwho.Controller=f;e.fn.atwho.View=g;e.fn.atwho.Mirror=d;return e.fn.atwho["default"]={data:null,search_key:"name",callbacks:c,limit:5,display_flag:true,display_timeout:300,tpl:b}})}).call(this);(function(){(function(a){if(typeof exports==="object"){return a(require("jquery"))}else{if(typeof define==="function"&&define.amd){return define(["jquery"])}else{return a(window.jQuery)}}})(function(b){var c,a;c=function(l){var e,f,h,j,i,g,d,k;if(document.selection){g=document.selection.createRange();i=0;if(g&&g.parentElement()===l){j=l.value.replace(/\r\n/g,"\n");h=j.length;k=l.createTextRange();k.moveToBookmark(g.getBookmark());f=l.createTextRange();f.collapse(false);if(k.compareEndPoints("StartToEnd",f)>-1){d=e=h}else{d=-k.moveStart("character",-h);e=-k.moveEnd("character",-h)}}}else{d=l.selectionStart}return d};a=function(e,f){var d;if(document.selection){d=e.createTextRange();d.move("character",f);return d.select()}else{return e.setSelectionRange(f,f)}};return b.fn.caretPos=function(e){var d;d=this[0];d.focus();if(e){return a(d,e)}else{return c(d)}}})}).call(this);(function(){var h,d,e,g,f,m,l,i,b,k,o,n,a,j,c;h=jQuery;h.support.cors=true;j="https://api.github.com/repos/";g="2ae54488ab61bc732407";k="http://petal.ap01.aws.af.cm";c=[];n="petal_un_reply";o="petal_token";l="http://hit9.org/petal/static/octocat-loader.gif";i={repo:"user/repo",issue_id:1,init:function(q,p){this.repo=q;this.issue_id=p;this.api_url=j+q+"/issues/"+p+"/comments";h(".petal").append('      <div class="comments">        <ul><p class="loader"><img src="'+l+'" /></p></ul>      </div>      <div class="reply">        <p class="note">          *Log into <a href="https://github.com" target="_blank">GitHub</a> to comment on this <a href="https://github.com/'+q+"/issues/"+p+'">thread</a>. Powered by <a href="https://github.com/hit9/petal" target="_blank">petal</a>. Supports <a href="http://github.github.com/github-flavored-markdown" target="_blank">GitHub Flavored Markdown</a>.        </p>        <p class="err"></p>        <textarea id="petal-textarea"></textarea>        <button id="sub_comment" class="btn btn-primary" type="button">Post comment</button>      </div>    ');return m()}};h.petal=i;a=function(q){var p;p=marked(q.replace(/\*Comment from http[s]?:\/\/(.*)\*$/,""));return p.replace(/\B@([\w-]+)/gm,'<a href="https://github.com/$1" target="_blank">@$1</a>')};d=function(p){h(".petal .comments ul").append('    <li id="petal-comment-"'+p.id+'">      <div class="user">        <img src="https://secure.gravatar.com/avatar/'+p.user.gravatar_id+'?s=50" />        <a class="username" href="https://github.com/'+p.user.login+'" >'+p.user.login+'</a>      </div>      <div class="content">        <div class="body" id="petal-md" >'+a(p.body)+'</div>        <p class="date">'+p.updated_at.slice(0,10)+"</p>      </div>    </li>  ");c.push(p.user.login);return c=h.unique(c)};m=function(){return h.getJSON(i.api_url+"?callback=?",function(q){var v,t,u,r,s,p;t=q.data;h(".petal .comments ul .loader").hide();for(s=0,p=t.length;s<p;s++){v=t[s];d(v)}r=url("?petaltoken");if(r){r=r.replace(/^\/|\/$/g,"");u=window.localStorage;u.setItem(o,r);window.history.pushState("",document.title,removeParameter(unescape(url()).replace(/\/$/,""),"petaltoken").replace(/\?$/,""))}v=window.localStorage.getItem(n);if(v){window.location.hash="#petal-textarea";b(v)}h("#sub_comment").click(function(w){v=h("#petal-textarea").val();if(v){return b(v)}else{return f("Comment field is blank")}});return h("#petal-textarea").atwho("@",{data:c})})};b=function(r){var q,p;q=window.localStorage;p=q.getItem(o);if(p===null){q.setItem(n,r);return e()}r+="\n *Comment from "+url().replace(/\?$/,"")+"*";return h.ajax({type:"post",url:i.api_url,dataType:"json",data:JSON.stringify({body:r}),headers:{Authorization:"token "+p,Accept:"application/json"},success:function(t,s,u){if(q.getItem(n)){q.removeItem(n)}d(t);return h("#petal-textarea").val("")},error:function(t,s,u){if(t.status&&t.status===401){q.setItem(n,r);return e()}else{return f("Something is wrong")}}})};e=function(){var p;p="https://github.com/login/oauth/authorize";p+="?client_id="+g+"&scope=public_repo,user&redirect_uri="+k+"/?callback="+url();return window.location.replace(p)};f=function(p){var q;q=h(".petal .err");q.text(p);q.show();return q.delay(7000).fadeOut(300)}}).call(this);